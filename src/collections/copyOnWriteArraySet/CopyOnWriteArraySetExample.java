package collections.copyOnWriteArraySet;

import java.util.Iterator;
import java.util.concurrent.CopyOnWriteArraySet;

/*
üîç –©–æ —Ç–∞–∫–µ CopyOnWriteArraySet?

CopyOnWriteArraySet ‚Äî —Ü–µ –ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –º–Ω–æ–∂–∏–Ω–∏ (Set), —è–∫–∞ –±–∞–∑—É—î—Ç—å—Å—è –Ω–∞ CopyOnWriteArrayList.
–ö–æ–∂–Ω–æ–≥–æ —Ä–∞–∑—É, –∫–æ–ª–∏ –º–Ω–æ–∂–∏–Ω–∞ –º–æ–¥–∏—Ñ—ñ–∫—É—î—Ç—å—Å—è (add, remove), —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –Ω–æ–≤–∞ –∫–æ–ø—ñ—è –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ–≥–æ –º–∞—Å–∏–≤—É.
–ß–∏—Ç–∞—á—ñ (readers) –ø—Ä–∞—Ü—é—é—Ç—å –∑ –Ω–µ–∑–º—ñ–Ω–Ω–æ—é –∫–æ–ø—ñ—î—é, —Ç–æ–º—É —ñ—Ç–µ—Ä–∞—Ü—ñ—è –±–µ–∑–ø–µ—á–Ω–∞ —ñ –Ω–µ –ø–æ—Ç—Ä–µ–±—É—î –±–ª–æ–∫—É–≤–∞–Ω—å.

---

‚úÖ –ü–µ—Ä–µ–≤–∞–≥–∏:
- –ü–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω–∏–π –±–µ–∑ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó (–Ω–µ–º–∞—î –ø–æ—Ç—Ä–µ–±–∏ –≤ synchronized).
- –ë–µ–∑–ø–µ—á–Ω–∞ —ñ—Ç–µ—Ä–∞—Ü—ñ—è ‚Äî –Ω–µ –±—É–¥–µ ConcurrentModificationException.
- –Ü–¥–µ–∞–ª—å–Ω–æ –¥–ª—è —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤ –∑ –≤–µ–ª–∏–∫–æ—é –∫—ñ–ª—å–∫—ñ—Å—Ç—é —á–∏—Ç–∞–Ω—å —ñ –º–∞–ª–æ—é –∫—ñ–ª—å–∫—ñ—Å—Ç—é –∑–º—ñ–Ω.
- –í—Å—ñ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ Set-–æ–ø–µ—Ä–∞—Ü—ñ—ó: —É–Ω—ñ–∫–∞–ª—å–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è, contains, remove.

---

‚ö† –ù–µ–¥–æ–ª—ñ–∫–∏:
- –í–∏—Å–æ–∫–∞ –≤–∞—Ä—Ç—ñ—Å—Ç—å –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ–π (add/remove), –±–æ –∫–æ–∂–Ω–∞ –æ–ø–µ—Ä–∞—Ü—ñ—è —Å—Ç–≤–æ—Ä—é—î –Ω–æ–≤–∏–π –º–∞—Å–∏–≤.
- –ù–µ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤ –∑ —á–∞—Å—Ç–∏–º–∏ –∑–º—ñ–Ω–∞–º–∏ –∞–±–æ –≤–µ–ª–∏–∫–∏–º–∏ –Ω–∞–±–æ—Ä–∞–º–∏ –¥–∞–Ω–∏—Ö.
- –ù–µ –≥–∞—Ä–∞–Ω—Ç—É—î —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è (—è–∫ TreeSet –∞–±–æ ConcurrentSkipListSet).

---

üì¶ –ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏:
- –û–±—Ä–æ–±–Ω–∏–∫–∏ –ø–æ–¥—ñ–π (listeners), —è–∫—ñ –¥–æ–¥–∞—é—Ç—å—Å—è —Ä—ñ–¥–∫–æ, –∞–ª–µ —á–∏—Ç–∞—é—Ç—å—Å—è —á–∞—Å—Ç–æ.
- –ö–µ—à—ñ –∞–±–æ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó, —è–∫—ñ –∑–º—ñ–Ω—é—é—Ç—å—Å—è –Ω–µ—á–∞—Å—Ç–æ.
- –î–∞–Ω—ñ, —è–∫—ñ –ø–µ—Ä–µ–≤–∞–∂–Ω–æ —á–∏—Ç–∞—é—Ç—å—Å—è —É –±–∞–≥–∞—Ç—å–æ—Ö –ø–æ—Ç–æ–∫–∞—Ö –±–µ–∑ –∑–º—ñ–Ω–∏.

---

üÜö –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∑ ConcurrentSkipListSet:

| –û—Å–æ–±–ª–∏–≤—ñ—Å—Ç—å                     | CopyOnWriteArraySet        | ConcurrentSkipListSet       |
|-------------------------------|----------------------------|-----------------------------|
| –ü–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ–∫–∞                  | ‚úÖ                         | ‚úÖ                          |
| –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –Ω–∞ —á–∏—Ç–∞–Ω–Ω—è      | üîº –í–∏—Å–æ–∫–∞                  | üîº –í–∏—Å–æ–∫–∞                   |
| –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –Ω–∞ –∑–º—ñ–Ω—É        | üîΩ –ù–∏–∑—å–∫–∞ (–∫–æ–ø—ñ—é—î –º–∞—Å–∏–≤)   | ‚öñ –ü–æ–º—ñ—Ä–Ω–∞ (fine-grained lock) |
| –í–∏—Ç—Ä–∞—Ç–∏ –ø–∞–º º—è—Ç—ñ                | üîΩ –ë—ñ–ª—å—à—ñ                  | ‚öñ –ú–µ–Ω—à—ñ                    |
| –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è                     | ‚ùå                         | ‚úÖ (natural ordering)       |
| Null-–∑–Ω–∞—á–µ–Ω–Ω—è                  | ‚úÖ –î–æ–∑–≤–æ–ª–µ–Ω—ñ               | ‚ùå –ó–∞–±–æ—Ä–æ–Ω–µ–Ω—ñ               |
| –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è                  | –†—ñ–¥–∫—ñ –∑–º—ñ–Ω–∏                | –ß–∞—Å—Ç—ñ –∑–º—ñ–Ω–∏                 |

---
*/

public class CopyOnWriteArraySetExample {
    public static void main(String[] args) {
        CopyOnWriteArraySet<String> set = new CopyOnWriteArraySet<>();

        set.add("Java");
        set.add("Concurrency");
        set.add("Java"); // –î—É–±–ª—ñ–∫–∞—Ç –Ω–µ –±—É–¥–µ –¥–æ–¥–∞–Ω–∏–π

        Iterator<String> iterator = set.iterator();

        // –î–æ–¥–∞—î–º–æ –Ω–æ–≤–∏–π –µ–ª–µ–º–µ–Ω—Ç –ø—ñ—Å–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —ñ—Ç–µ—Ä–∞—Ç–æ—Ä–∞
        set.add("Threads");

        System.out.println("–Ü—Ç–µ—Ä–∞—Ü—ñ—è (—Å—Ç–∞—Ä–∏–π –∑–Ω—ñ–º–æ–∫):");
        iterator.forEachRemaining(System.out::println); // –ù–µ –ø–æ–±–∞—á–∏—Ç—å "Threads"

        System.out.println("–Ü—Ç–µ—Ä–∞—Ü—ñ—è –ø—ñ—Å–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è:");
        for (String value : set) {
            System.out.println(value); // –ü–æ–±–∞—á–∏—Ç—å —É—Å—ñ –∑–Ω–∞—á–µ–Ω–Ω—è, –≤–∫–ª—é—á–∞—é—á–∏ "Threads"
        }
    }
}
